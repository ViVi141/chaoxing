# 部署方案选择指南

**快速选择**：根据你的需求选择合适的配置文件

---

## 📊 三种方案对比

| 特性 | **极简版**<br/>minimal | **简化版**<br/>simple | **完整版**<br/>标准 |
|------|-------------|------------|----------|
| **配置文件** | `docker-compose.minimal.yml` | `docker-compose.simple.yml` | `docker-compose.yml` |
| **容器数量** | 1个 | 3个 | 4个 |
| **内存占用** | ~200MB | ~370MB | ~470MB |
| **启动时间** | 5秒 | 15秒 | 30秒 |
| **配置复杂度** | ⭐ 最简单 | ⭐⭐ 简单 | ⭐⭐⭐ 中等 |
| | | | |
| **数据库** | SQLite | SQLite | PostgreSQL |
| **Redis** | ❌ 无 | ✅ 有 | ✅ 有 |
| **Celery** | ❌ 无 | ✅ 有 | ✅ 有 |
| | | | |
| **Web管理界面** | ✅ | ✅ | ✅ |
| **登录/注册** | ✅ | ✅ | ✅ |
| **课程管理** | ✅ | ✅ | ✅ |
| **手动刷课** | ✅ | ✅ | ✅ |
| **自动刷课** | ❌ | ✅ | ✅ |
| **定时任务** | ❌ | ✅ | ✅ |
| **多用户支持** | 1-5人 | 1-20人 | 20+人 |

---

## 🎯 方案1：极简版（推荐新手）

### 适合场景
- ✅ 第一次使用，想快速体验
- ✅ 个人使用（1-5人）
- ✅ 只需要手动点击刷课
- ✅ 服务器配置较低

### 启动命令
```bash
cd web
docker compose -f docker-compose.minimal.yml up -d
```

### Windows一键启动
```bash
cd web
快速启动-极简版.bat
```

### 包含组件
```
只有1个容器：
├── Backend（FastAPI + SQLite）
```

### 功能清单
- ✅ **完整的Web管理界面**
- ✅ 用户注册/登录
- ✅ 课程列表查看
- ✅ 手动点击"开始学习"
- ✅ 配置管理
- ❌ 自动刷课（需要手动点击）
- ❌ 定时任务
- ❌ 后台批量处理

### 资源占用
- 内存：~200MB
- CPU：低
- 磁盘：~500MB

---

## 🎯 方案2：简化版（推荐大多数用户）⭐⭐⭐⭐⭐

### 适合场景
- ✅ **需要自动刷课功能**
- ✅ 小团队使用（1-20人）
- ✅ 想要完整功能但不想配置复杂数据库
- ✅ 快速部署

### 启动命令
```bash
cd web
docker compose -f docker-compose.simple.yml up -d
```

### Windows一键启动
```bash
cd web
快速启动.bat
```

### 包含组件
```
3个容器：
├── Redis（消息队列，20MB内存）
├── Backend（FastAPI + SQLite）
└── Celery Worker（后台任务处理）
```

### 功能清单
- ✅ **所有极简版功能**
- ✅ **自动刷课（重点！）**
- ✅ 定时任务
- ✅ 后台批量处理
- ✅ 异步任务队列

### 资源占用
- 内存：~370MB
- CPU：中等
- 磁盘：~600MB

### 为什么需要Redis？
```
用户在Web界面点击"自动刷课"
    ↓
后端创建刷课任务 → 发送到Redis队列
    ↓
Celery Worker从Redis取任务 → 后台执行刷课
    ↓
完成后更新数据库 → Web界面显示结果
```

**如果没有Redis**：
- ❌ 长时间任务会阻塞Web请求
- ❌ 无法并发处理多个刷课任务
- ❌ 任务失败无法重试
- ❌ 无法查看任务进度

---

## 🎯 方案3：完整版（生产环境）

### 适合场景
- ✅ 生产环境部署
- ✅ 多用户使用（20+人）
- ✅ 需要高性能和可靠性
- ✅ 有运维经验

### 启动命令
```bash
cd web
docker compose up -d
```

### 包含组件
```
4个容器：
├── PostgreSQL（高性能数据库）
├── Redis（消息队列）
├── Backend（FastAPI）
└── Celery Worker（后台任务处理）
```

### 优势
- ✅ PostgreSQL支持高并发
- ✅ 数据一致性更好
- ✅ 支持复杂查询
- ✅ 可扩展性强

### 资源占用
- 内存：~470MB
- CPU：中等偏高
- 磁盘：~800MB

---

## 🤔 如何选择？

### 问题1：你需要自动刷课吗？

**不需要** → **极简版**（docker-compose.minimal.yml）
- 在Web界面手动点击刷课就够了

**需要** → 继续问题2

### 问题2：有多少用户？

**1-20人** → **简化版**（docker-compose.simple.yml）⭐ 推荐
- SQLite够用，配置简单

**20人以上** → **完整版**（docker-compose.yml）
- PostgreSQL性能更好

---

## 📝 快速启动流程

### 方案1：极简版
```bash
cd web
docker compose -f docker-compose.minimal.yml up -d
# 访问 http://localhost:8000
```

### 方案2：简化版（推荐）
```bash
cd web
docker compose -f docker-compose.simple.yml up -d
# 访问 http://localhost:8000
```

### 方案3：完整版
```bash
cd web
docker compose up -d
# 访问 http://localhost:8000
```

---

## ❓ 常见问题

### Q1：为什么默认配置包含Redis？

**A**：因为大多数用户下载这个项目是为了**自动刷课**，而自动刷课必须使用Celery，Celery必须使用消息队列（Redis或RabbitMQ）。Redis是最轻量级的选择（只需20MB内存）。

### Q2：我不需要自动刷课，能去掉Redis吗？

**A**：可以！使用 `docker-compose.minimal.yml`，只有1个容器，无Redis。

### Q3：手动刷课和自动刷课有什么区别？

**手动刷课**：
- 打开Web界面
- 点击"开始学习"按钮
- 等待刷课完成
- 适合偶尔使用

**自动刷课**：
- 设置定时任务（如每天晚上8点）
- 系统自动执行刷课
- 后台运行，不需要手动点击
- 适合长期使用

### Q4：Redis会增加很多内存占用吗？

**A**：不会。Redis只占用约20MB内存，几乎可以忽略不计。

### Q5：我能先用极简版，以后升级到简化版吗？

**A**：完全可以！数据库文件在 `backend/data/chaoxing.db`，直接切换配置文件即可。

```bash
# 停止极简版
docker compose -f docker-compose.minimal.yml down

# 启动简化版（数据会保留）
docker compose -f docker-compose.simple.yml up -d
```

### Q6：如果启动失败怎么办？

**A**：查看错误日志，参考 `DOCKER_TROUBLESHOOT.md` 文档。

最常见的问题：
1. 端口被占用 → 修改端口映射
2. 镜像拉取失败 → 使用代理或从源码构建
3. 权限问题 → `chmod 777 backend/data backend/logs`

---

## 🚀 我的推荐

### 新手第一次使用
1. 先用**极简版**快速体验（5分钟）
2. 如果觉得好用，升级到**简化版**（支持自动刷课）

### 长期使用
- **简化版**（docker-compose.simple.yml）
- 稳定、功能完整、配置简单

### 生产环境/多用户
- **完整版**（docker-compose.yml）
- PostgreSQL + Redis + Celery

---

## 📞 需要帮助？

如果遇到问题：
1. 查看日志：`docker logs chaoxing_minimal -f`
2. 查看故障排查文档
3. 提供完整错误信息以便诊断

选择你的方案，开始使用吧！🎉

