# Refine 完整版测试指南

## 🧪 完整测试流程

### 前置准备

1. **确保后端服务运行**
   ```bash
   cd web/backend
   python run_app.py
   ```
   应该看到: "Uvicorn running on http://0.0.0.0:8000"

2. **确保Celery运行**
   ```bash
   cd web/backend
   python run_celery.py
   ```
   应该看到: "celery@... ready."

3. **启动Refine前端**
   ```bash
   cd web/frontend
   npm run dev
   ```
   应该看到: "Local: http://localhost:5173/"

---

## 📋 功能测试清单

### 第1阶段：认证系统（5分钟）

#### 测试1.1: 登录功能
1. 访问 http://localhost:5173
2. 应自动跳转到 `/login`
3. 输入: admin / Admin@123
4. 点击"登录"
5. ✅ 应成功进入仪表盘

**验证点**:
- [ ] 登录页面UI正常
- [ ] 输入验证工作
- [ ] 登录成功跳转
- [ ] 无401错误
- [ ] Token已保存到localStorage

#### 测试1.2: 权限控制
1. 登录后访问管理员菜单
2. ✅ 管理员用户应该能看到"管理员"菜单

**验证点**:
- [ ] 管理员菜单可见
- [ ] 子菜单正常展开

#### 测试1.3: 登出功能
1. 点击右上角用户菜单
2. 点击"登出"
3. ✅ 应跳转回登录页

**验证点**:
- [ ] Token已清除
- [ ] 跳转到登录页
- [ ] 无法访问受保护页面

---

### 第2阶段：配置管理（10分钟）

#### 测试2.1: 超星账号配置
1. 登录后点击"配置管理"
2. 点击"超星账号"标签
3. 填写：
   - 手机号: 13800138000
   - 密码: test123456
   - 倍速: 1.5
4. 点击"保存配置"
5. ✅ 应显示"配置保存成功"

**验证点**:
- [ ] 表单验证工作（手机号格式）
- [ ] 保存成功提示
- [ ] 刷新页面配置仍在

#### 测试2.2: 题库配置
1. 点击"题库配置"标签
2. 选择题库: 言溪题库
3. 输入Token
4. 设置延迟和覆盖率
5. 开启"自动提交"
6. 保存
7. ✅ 应成功保存

**验证点**:
- [ ] 题库选择联动显示配置项
- [ ] 保存成功
- [ ] 配置持久化

#### 测试2.3: 通知配置
1. 点击"通知配置"标签
2. 选择: Server酱
3. 输入Webhook URL
4. 保存
5. ✅ 应成功保存

**验证点**:
- [ ] URL格式验证
- [ ] 保存成功
- [ ] 配置持久化

---

### 第3阶段：任务管理（15分钟）

#### 测试3.1: 创建任务
1. 点击"任务管理"
2. 点击"创建"
3. 填写：
   - 课程ID: 123456
   - 课程名称: 测试课程
   - 倍速: 1.5
4. 展开"高级配置"
5. 设置题库和重试次数
6. 保存
7. ✅ 应跳转到任务列表

**验证点**:
- [ ] 表单所有字段可用
- [ ] 验证规则工作
- [ ] 创建成功
- [ ] 任务出现在列表中

#### 测试3.2: 查看任务详情
1. 在任务列表点击任务
2. ✅ 应进入任务详情页

**验证点**:
- [ ] 所有信息正确显示
- [ ] 进度条显示
- [ ] 状态标签正确
- [ ] 日志区域显示

#### 测试3.3: 任务控制
1. 在任务详情页
2. 点击"开始任务"
3. ✅ 任务应开始执行
4. 观察实时日志
5. ✅ 日志应实时更新

**验证点**:
- [ ] 控制按钮可用
- [ ] 状态正确变化
- [ ] WebSocket日志实时显示
- [ ] 进度条实时更新

#### 测试3.4: 任务操作
1. 运行中的任务点击"暂停"
2. ✅ 应暂停
3. 点击"继续"
4. ✅ 应继续
5. 点击"取消"
6. ✅ 应取消

**验证点**:
- [ ] 所有控制按钮工作
- [ ] 状态正确切换
- [ ] 日志记录操作

---

### 第4阶段：用户管理（5分钟）

#### 测试4.1: 用户列表
1. 访问用户管理（如果有权限）
2. ✅ 应显示用户列表

**验证点**:
- [ ] 列表正常显示
- [ ] 分页工作
- [ ] 操作按钮可用

---

### 第5阶段：管理员功能（10分钟）

#### 测试5.1: 管理员控制台
1. 点击"管理员" → "控制台"
2. ✅ 应显示8项统计指标

**验证点**:
- [ ] 所有统计数据显示
- [ ] 最近用户列表
- [ ] 活跃任务列表
- [ ] 系统信息

#### 测试5.2: 用户管理（管理员）
1. 点击"管理员" → "用户管理"
2. ✅ 应显示所有用户
3. 切换用户状态
4. ✅ 应成功更新

**验证点**:
- [ ] 显示所有用户
- [ ] 状态开关工作
- [ ] 删除功能工作

#### 测试5.3: 任务监控（管理员）
1. 点击"管理员" → "任务监控"
2. ✅ 应显示所有任务
3. 强制取消某个任务
4. ✅ 应成功取消

**验证点**:
- [ ] 显示所有用户的任务
- [ ] 筛选器工作
- [ ] 强制操作可用

---

### 第6阶段：实时功能（5分钟）

#### 测试6.1: WebSocket连接
1. 打开浏览器Console (F12)
2. 应看到: "[WS] Connected successfully"
3. ✅ WebSocket已连接

#### 测试6.2: 实时进度更新
1. 创建并启动一个任务
2. 打开任务详情页
3. ✅ 应看到实时日志不断更新
4. ✅ 进度条实时增加

**验证点**:
- [ ] WebSocket连接成功
- [ ] 实时日志显示
- [ ] 进度条实时更新
- [ ] 状态自动刷新

---

## 🐛 问题排查

### 问题1: 无法登录
**检查**:
- 后端是否运行？
- Console是否有401错误？
- 用户名密码是否正确？

**解决**:
```bash
# 重启后端
taskkill /F /IM python.exe
启动后端.bat
```

### 问题2: CORS错误
**检查**:
- 后端CORS配置
- 前端请求地址

**解决**:
- 后端已配置 `allow_origins=["*"]`
- 应该不会有CORS问题

### 问题3: WebSocket未连接
**检查**:
- Console是否有WS错误？
- Token是否有效？

**解决**:
- 确保后端WebSocket端点可用
- 重新登录获取新token

### 问题4: 页面空白
**检查**:
- Console是否有JavaScript错误？
- npm依赖是否完整？

**解决**:
```bash
cd web/frontend
rm -rf node_modules
npm install
```

---

## ✅ 测试通过标准

- [ ] 所有页面正常显示
- [ ] 登录/登出正常
- [ ] CRUD操作成功
- [ ] 实时更新工作
- [ ] 无Console错误
- [ ] 无401/403错误
- [ ] 移动端适配良好

---

## 📊 性能测试

### 加载性能
- 首屏加载: < 2秒
- 页面切换: < 500ms
- API响应: < 200ms

### 并发测试
- 同时10个用户登录
- 同时创建5个任务
- WebSocket同时100个连接

---

## 🎯 测试结果记录

| 功能模块 | 状态 | 备注 |
|---------|------|------|
| 认证系统 | ⬜ |  |
| 配置管理 | ⬜ |  |
| 任务管理 | ⬜ |  |
| 用户管理 | ⬜ |  |
| 管理员功能 | ⬜ |  |
| 实时更新 | ⬜ |  |

**测试人员**: _______  
**测试时间**: _______  
**通过率**: _______  

---

## 📞 支持

遇到问题？
1. 查看Console错误
2. 查看后端日志
3. 参考文档: REFINE_VERSION_COMPLETE.md

---

**测试愉快！** 🎉

