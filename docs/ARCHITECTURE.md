# 🏗️ 项目架构

## 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                      用户浏览器                          │
│                   (React 18 + Ant Design)               │
└────────────┬────────────────────────────────────────────┘
             │ HTTP/WebSocket
┌────────────▼────────────────────────────────────────────┐
│                    FastAPI 后端                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │  认证API  │  │  任务API │  │ WebSocket│             │
│  └──────────┘  └──────────┘  └──────────┘             │
└────────────┬──────────┬─────────────────────────────────┘
             │          │
    ┌────────▼──────┐   │
    │  SQLite/PG    │   │
    │   数据库      │   │
    └───────────────┘   │
                   ┌────▼──────────┐
                   │ Celery Worker │
                   │  (异步任务)   │
                   └───────┬───────┘
                           │
                    ┌──────▼──────┐
                    │  超星API    │
                    └─────────────┘
```

## 技术栈

### 后端
- **FastAPI 0.115.0** - 现代Web框架
- **SQLAlchemy 2.0.35** - 异步ORM
- **Celery 5.4.0** - 异步任务队列
- **JWT** - 用户认证
- **WebSocket** - 实时通信

### 前端  
- **React 18.3.1** - UI框架
- **Refine 4.53.0** - 后台管理框架
- **Ant Design 5.21.6** - UI组件库
- **Vite 5.4.10** - 构建工具

### 数据库
- **SQLite** - 简单模式
- **PostgreSQL** - 标准模式

### 任务队列
- **文件系统** - 简单模式
- **Redis** - 标准模式

## 核心模块

### API模块（命令行和Web共用）
```
api/
├── base.py              # 超星API封装
├── answer.py            # 题库集成
├── course_processor.py  # 课程处理逻辑
├── logger.py            # 日志系统
└── secure_config.py     # 配置加密
```

### Web后端
```
web/backend/
├── app.py               # FastAPI应用
├── models.py            # 数据模型（5个表）
├── routes/              # API路由（7个模块）
├── tasks/               # Celery任务
└── auth.py              # JWT认证
```

### Web前端
```
web/frontend/
├── src/
│   ├── pages/           # 页面组件
│   ├── providers/       # 数据提供者
│   └── components/      # 通用组件
```

## 数据流

### 学习任务执行流程

```
用户创建任务
    ↓
后端API接收
    ↓
保存到数据库
    ↓
提交到Celery队列
    ↓
Celery Worker执行
    ↓
调用超星API
    ↓
实时推送进度(WebSocket)
    ↓
前端更新UI
    ↓
任务完成
```

## 安全设计

### 认证
- JWT令牌（有效期24小时）
- bcrypt密码哈希
- Fernet加密存储超星密码

### 授权
- 基于角色的访问控制(RBAC)
- 所有数据查询包含用户ID过滤
- WebSocket消息用户级隔离

### 数据隔离
- 用户只能访问自己的数据
- 管理员有全局访问权限
- 数据库级别隔离

---

详细API文档请查看：[API.md](API.md)

